{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": [
    "import requests\n",
    "from bs4 import BeautifulSoup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": [
    "res = requests.get(\"http://www.zaih.com/topics/?category_id=525&city=beijing\")\n",
    "soup = BeautifulSoup(res.text)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 43,
   "metadata": {},
   "outputs": [],
   "source": [
    "#category_id_list = [398,401,402,403,404,413,419,522,421,432,433,434,435,436,437,438,439,440,441,442,443,444,449,523,\n",
    "#               343,348,357,364,369,374,375,517,528,390,391,392,393,394,395,396,518,451,456,457,464,465,470,473,\n",
    "#               474,477,514,519,527,480,481,482,483,484,516,521,486,487,488,489,490,491,492,493,494,524,496,497,\n",
    "#               498,499,500,501,502,505,525]\n",
    "#region_list = ['beijing','shanghai','shenzhen','guangzhou','hangzhou','chengdu','xian','wuhan','ningbo']\n",
    "category_id_list = [398]\n",
    "region_list = ['beijing']"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 50,
   "metadata": {},
   "outputs": [],
   "source": [
    "def get_topic_title_link(region, cat_id):\n",
    "    page = 1\n",
    "    while True:\n",
    "        res = requests.get(\"http://www.zaih.com/topics/?category_id=%s&city=%s&page=%d\" % (cat_id, region, page))\n",
    "        soup = BeautifulSoup(res.text)\n",
    "        for link in soup.select(\"a.topic-tutor-link\"):\n",
    "            yield link['href']\n",
    "        if soup.select(\"span.icon.icon-next\") == []:\n",
    "            break\n",
    "        page += 1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 52,
   "metadata": {},
   "outputs": [],
   "source": [
    "def crawl_mentor_page(region, cat_id, mentor_link):\n",
    "    print 1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 39,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "/mentor/84745870/topic/29860000/\n",
      "/mentor/85044083/topic/29879086/\n",
      "/mentor/84904358/topic/29870510/\n",
      "/mentor/84747127/topic/29868950/\n",
      "/mentor/84754141/topic/29860909/\n",
      "/mentor/84751687/topic/29865684/\n",
      "/mentor/84892572/topic/29871447/\n",
      "/mentor/84762304/topic/29861119/\n",
      "/mentor/84752566/topic/29860364/\n",
      "/mentor/84788395/topic/29863759/\n",
      "/mentor/84884635/topic/29869612/\n",
      "/mentor/84791395/topic/29863825/\n",
      "/mentor/84882383/topic/29879491/\n",
      "/mentor/84790024/topic/29863712/\n",
      "[]\n"
     ]
    }
   ],
   "source": [
    "res = requests.get(\"http://www.zaih.com/topics/?category_id=398&city=beijing&page=10\")\n",
    "soup = BeautifulSoup(res.text)\n",
    "for link in soup.select(\"a.topic-tutor-link\"):\n",
    "    print link['href']\n",
    "print soup.select(\"span.icon.icon-next\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 45,
   "metadata": {},
   "outputs": [],
   "source": [
    "for region in region_list:\n",
    "    for cat_id in category_id_list:\n",
    "        # reset the list\n",
    "        topic_title_link = []\n",
    "        \n",
    "        # get all mentor page link under the same region and categories\n",
    "        topic_title_link += get_topic_title_link(region, cat_id)\n",
    "        \n",
    "        # crawl each mentor's page\n",
    "        for mentor_link in topic_title_link:\n",
    "            crawl_mentor_page(region, cat_id, mentor_link)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 47,
   "metadata": {},
   "outputs": [],
   "source": [
    "topic_title_link = [u'/mentor/85071906/topic/29875060/']"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 49,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "/mentor/85071906/topic/29875060/\n"
     ]
    }
   ],
   "source": [
    "for i in topic_title_link:\n",
    "    print i"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 2",
   "language": "python",
   "name": "python2"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 2
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython2",
   "version": "2.7.13"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
